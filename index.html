<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kuis Nahwu</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#020617,#000);
  display:flex;
  justify-content:center;
  align-items:center;
  color:#e5e7eb;
  font-family:"Times New Roman",serif;
}

.quiz-box{
  width:100%;
  max-width:720px;
  background:rgba(2,6,23,.96);
  border:1px solid #1e293b;
  border-radius:22px;
  padding:25px;
  box-shadow:0 0 40px rgba(0,0,0,.6);
}

#questionText{
  font-family:"Amiri",serif;
  font-size:1.45rem;
  margin:22px 0;
  text-align:center;
}

.answer-buttons{
  display:grid;
  gap:14px;
}
.answer-buttons button{
  padding:14px;
  background:#020617;
  border:1px solid #334155;
  border-radius:16px;
  color:#e5e7eb;
  font-size:1.2rem;
  cursor:pointer;
  transition:.25s ease;
  font-family:"Amiri",serif;
}
.answer-buttons button:hover{background:#1e293b}
.answer-buttons button.correct{
  border-color:#22c55e;
  color:#22c55e;
  box-shadow:0 0 12px rgba(34,197,94,.45);
}
.answer-buttons button.wrong{
  background:#3f0d0d;
  border-color:#ef4444;
  color:#ef4444;
}

.score-board{
  margin-top:20px;
  padding:14px;
  border-radius:16px;
  background:#020617;
  border:1px solid #334155;
  text-align:center;
}
.score-pop{animation:scorePop .4s ease}
@keyframes scorePop{
  0%{transform:scale(1)}
  50%{transform:scale(1.15)}
  100%{transform:scale(1)}
}

#result{
  margin-top:18px;
  padding:15px;
  border-radius:16px;
  border:1px solid #334155;
}
.correct-text{color:#22c55e;font-weight:bold}
.wrong-text{color:#ef4444;font-weight:bold}
.explain{
  margin-top:10px;
  font-family:"Amiri",serif;
  background:#020617;
  padding:12px;
  border-radius:12px;
  border-left:4px solid #38bdf8;
  line-height:1.7;
}

#nextBtn{
  margin-top:22px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#2563eb;
  color:white;
  cursor:pointer;
}
#nextBtn:hover{background:#1d4ed8}

.hidden{display:none}

#finalResult{
  opacity:0;
  transform:scale(.96);
  transition:.5s ease;
}
#finalResult.show{
  opacity:1;
  transform:scale(1);
}

.feedback{
  margin-top:15px;
  padding:12px;
  border-radius:14px;
  border:1px solid #334155;
}

/* ===== REKAP SALAH ===== */
.wrong-item{
  margin-top:16px;
  padding:14px;
  border-radius:16px;
  background:#020617;
  border:1px solid #334155;
}
.wrong-item h4{
  margin:0 0 8px;
  font-weight:normal;
}
.bad{color:#ef4444}
.good{color:#22c55e}
.explain-box{
  margin-top:10px;
  padding:10px;
  border-left:4px solid #38bdf8;
  background:#020617;
  border-radius:12px;
  font-family:"Amiri",serif;
}

/* ===== ACTION ===== */
.action-box{
  margin-top:25px;
  display:grid;
  gap:12px;
}
.action-box button{
  padding:14px;
  border:none;
  border-radius:16px;
  cursor:pointer;
  color:white;
}
.wa{background:#22c55e}
.ig{background:#db2777}
.fb{background:#1877f2}
.yt{background:#dc2626}
.gg{background:#334155}

/* ===== TIMER PANIC (5 DETIK TERAKHIR) ===== */
.timer-warning{
  animation:pulseRed 1s infinite;
  box-shadow:0 0 25px rgba(239,68,68,.6);
  border-color:#ef4444 !important;
}
@keyframes pulseRed{
  0%{background:#020617}
  50%{background:#3f0d0d}
  100%{background:#020617}
}
</style>
</head>

<body>
<div class="quiz-box">
  <div id="quiz">
    <div id="questionText"></div>
    <div id="answers" class="answer-buttons"></div>

    <div class="score-board">
      Skor: <b id="scoreNum">0</b> / 100<br>
      Benar: <span id="cNum">0</span> | Salah: <span id="wNum">0</span>
    </div>

    <div id="result" class="hidden"></div>
    <button id="nextBtn" class="hidden">Soal Selanjutnya</button>
  </div>

  <div id="finalResult" class="hidden">
    <h2>Hasil Akhir</h2>
    <div id="scoreText"></div>
    <div class="feedback" id="feedbackText"></div>

    <h3>üìå Rekap Jawaban Salah</h3>
    <div id="wrongList"></div>

    <div class="action-box">
      <button class="wa" onclick="shareWA()">üì± Share Story WhatsApp</button>
      <button class="ig" onclick="shareIG()">üì∏ Share Story Instagram</button>
      <button class="fb" onclick="shareFB()">üìò Share Facebook</button>
      <button class="yt" onclick="goYouTube()">‚ñ∂Ô∏è YouTube</button>
      <button class="gg" onclick="goGoogle()">üåê Google</button>
    </div>
  </div>
</div>

<script>
const POINT = 5;
const TIME_LIMIT = 20000;

let data = [], idx = 0, score = 0, correct = 0, wrongCount = 0, wrong = [];
let currentOptions = [];
let timer = null;
let timerActive = false;

const scoreNum = document.getElementById("scoreNum");
const cNum = document.getElementById("cNum");
const wNum = document.getElementById("wNum");
const questionText = document.getElementById("questionText");
const answers = document.getElementById("answers");
const result = document.getElementById("result");
const nextBtn = document.getElementById("nextBtn");
const quiz = document.getElementById("quiz");
const finalResult = document.getElementById("finalResult");
const scoreText = document.getElementById("scoreText");
const feedbackText = document.getElementById("feedbackText");
const wrongList = document.getElementById("wrongList");
const quizBox = document.querySelector(".quiz-box");

fetch("soal.json")
  .then(r => r.json())
  .then(d => {
    data = d;
    show();
  });

function shuffle(arr){
  for(let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function animateNumber(el, from, to){
  el.classList.add("score-pop");
  let cur = from, step = (to - from) / 15;
  let i = setInterval(()=>{
    cur += step;
    el.textContent = Math.round(cur);
    if(cur >= to){
      el.textContent = to;
      clearInterval(i);
      setTimeout(()=>el.classList.remove("score-pop"),300);
    }
  },20);
}

function updateScore(){
  animateNumber(scoreNum, Number(scoreNum.textContent), score);
  cNum.textContent = correct;
  wNum.textContent = wrongCount;
}

/* ===== TIMER ===== */
function startTimer(){
  clearTimeout(timer);
  timerActive = true;
  quizBox.classList.remove("timer-warning");

  setTimeout(()=>{
    if(timerActive) quizBox.classList.add("timer-warning");
  }, TIME_LIMIT - 5000);

  timer = setTimeout(()=>{
    if(timerActive) timeUp();
  }, TIME_LIMIT);
}

function timeUp(){
  timerActive = false;
  quizBox.classList.remove("timer-warning");
  wrongCount++;

  const q = data[idx];
  const buttons = [...answers.children];
  const correctOpt = currentOptions.find(o=>o.isCorrect);

  buttons.forEach((b,i)=>{
    if(currentOptions[i].isCorrect) b.classList.add("correct");
    b.disabled = true;
  });

  wrong.push({
    q: q.question,
    wrong: "‚è∞ Tidak dijawab",
    correct: correctOpt.text,
    exp: q.explanation
  });

  result.classList.remove("hidden");
  result.innerHTML = `
    <div class="wrong-text">‚è∞ Waktu habis</div>
    <div class="explain">${q.explanation}</div>
  `;

  updateScore();
  nextBtn.classList.remove("hidden");
}

function show(){
  const q = data[idx];
  questionText.innerText = `Soal ${idx+1}: ${q.question}`;
  answers.innerHTML = "";

  currentOptions = ["A","B","C","D","E"].map((l,i)=>({
    text: q["option_"+l],
    isCorrect: i === Number(q.answer_index)
  }));

  shuffle(currentOptions);

  currentOptions.forEach(opt=>{
    const b = document.createElement("button");
    b.textContent = opt.text;
    b.onclick = ()=>check(b, opt);
    answers.appendChild(b);
  });

  result.classList.add("hidden");
  nextBtn.classList.add("hidden");

  startTimer();
}

function check(btn, opt){
  if(!timerActive) return;
  timerActive = false;
  clearTimeout(timer);
  quizBox.classList.remove("timer-warning");

  const q = data[idx];
  const buttons = [...answers.children];

  buttons.forEach((b,i)=>{
    if(currentOptions[i].isCorrect) b.classList.add("correct");
    if(b === btn && !opt.isCorrect) b.classList.add("wrong");
    b.disabled = true;
  });

  result.classList.remove("hidden");

  if(opt.isCorrect){
    correct++;
    score += POINT;
    result.innerHTML = `
      <div class="correct-text">‚úî Jawaban Benar</div>
      <div class="explain">${q.explanation}</div>`;
  }else{
    wrongCount++;
    const correctOpt = currentOptions.find(o=>o.isCorrect);
    wrong.push({
      q: q.question,
      wrong: opt.text,
      correct: correctOpt.text,
      exp: q.explanation
    });
    result.innerHTML = `<div class="wrong-text">‚úñ Jawaban Salah</div>`;
  }

  updateScore();
  nextBtn.classList.remove("hidden");
}

nextBtn.onclick = ()=>{
  clearTimeout(timer);
  quizBox.classList.remove("timer-warning");
  idx++;
  if(idx < data.length) show();
  else finish();
};

function finish(){
  quiz.classList.add("hidden");
  finalResult.classList.remove("hidden");
  finalResult.classList.add("show");

  scoreText.innerHTML = `Benar: <b>${correct}</b><br>Skor Akhir: <b>${score}</b>`;
  feedbackText.innerText =
    correct <= 5 ? "‚ùå Wawasan nahwu kamu kurang" :
    correct <= 10 ? "‚ö†Ô∏è Sudah ada dasar" :
    correct <= 15 ? "üëç Pemahaman cukup baik" :
    "üåü Luar biasa!";

  if(wrong.length === 0){
    wrongList.innerHTML = "<p>üéâ Tidak ada jawaban salah</p>";
  }else{
    wrong.forEach((w,i)=>{
      wrongList.innerHTML += `
      <div class="wrong-item">
        <h4>${i+1}. ${w.q}</h4>
        <div class="bad">‚ùå Jawaban kamu: ${w.wrong}</div>
        <div class="good">‚úÖ Jawaban benar: ${w.correct}</div>
        <div class="explain-box">${w.exp}</div>
      </div>`;
    });
  }
}

/* ===== ACTION ===== */
const shareText = ()=>`Aku baru saja mengerjakan Kuis Nahwu üìù
Skor: ${score}/100
Benar: ${correct}, Salah: ${wrongCount}`;

function shareWA(){
  window.open(`https://wa.me/?text=${encodeURIComponent(shareText())}`,'_blank');
}
function shareIG(){
  navigator.share({title:"Kuis Nahwu",text:shareText(),url:location.href});
}
function shareFB(){
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}`,'_blank');
}
function goYouTube(){location.href="https://www.youtube.com"}
function goGoogle(){location.href="https://www.google.com"}
</script>
</body>
</html>
